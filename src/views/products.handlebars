<h1>Productos</h1>

<section class="toolbar" style="display:flex; gap:.5rem; flex-wrap:wrap; margin-bottom:10px;">
  <input id="q" type="search" placeholder="Buscar por título o categoría" value="{{query}}" />
  <select id="categorySelect"><option value="">Todas las categorías</option></select>
  <select id="statusSelect">
    <option value="">Disponibilidad</option>
    <option value="true" {{#if (eq status "true")}}selected{{/if}}>Disponible</option>
    <option value="false" {{#if (eq status "false")}}selected{{/if}}>No disponible</option>
  </select>
  <select id="sort">
    <option value="">Ordenar por precio</option>
    <option value="asc" {{#if (eq sort "asc")}}selected{{/if}}>Menor a mayor</option>
    <option value="desc" {{#if (eq sort "desc")}}selected{{/if}}>Mayor a menor</option>
  </select>
  <input id="limit" type="number" min="1" value="{{limit}}" style="width:100px" />
  <button id="apply">Aplicar</button>
</section>

{{#if products.length}}
  <ul id="productsList" class="grid" style="list-style:none; display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:1rem; padding:0;">
    {{#each products}}
      <li class="card" style="border:1px solid #e5e7eb; border-radius:8px; padding:1rem;">
        <h3 style="margin:0 0 .5rem 0;"><a href="/products/{{this._id}}">{{this.title}}</a></h3>
        <div style="font-size:.9em; color:#555; margin-bottom:.5rem;">{{this.description}}</div>
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <span><strong>${{this.price}}</strong> · {{this.category}}</span>
          <button class="addToCartBtn" data-pid="{{this._id}}">Agregar al carrito</button>
        </div>
      </li>
    {{/each}}
  </ul>

  <nav class="pagination" style="display:flex; gap:1rem; justify-content:center; align-items:center; margin-top:1rem;">
    {{#if hasPrevPage}}<a href="{{prevLink}}">« Anterior</a>{{/if}}
    <span>Página {{page}} de {{totalPages}}</span>
    {{#if hasNextPage}}<a href="{{nextLink}}">Siguiente »</a>{{/if}}
  </nav>
{{else}}
  <p>No hay productos para los filtros seleccionados.</p>
{{/if}}

{{!-- JS externo para evitar conflictos de template --}}
<script src="/public/js/products.js"></script>
